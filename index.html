<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"right","display":"always","offset":12,"onmobile":true,"dimmer":true},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="今天开始努力学习">
<meta property="og:url" content="https://bigphess.github.io/index.html">
<meta property="og:site_name" content="今天开始努力学习">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="今天开始努力学习">






  <link rel="canonical" href="https://bigphess.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>今天开始努力学习 – 面向谷歌编程选手许若芃</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">今天开始努力学习</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">面向谷歌编程选手许若芃</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">23</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">37</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/Bigphess" class="github-corner" title="垃圾代码都在我的github！" aria-label="垃圾代码都在我的github！" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/05/08/OpenCV19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/08/OpenCV19/" class="post-title-link" itemprop="url">学习OpenCV第19章，投影和3D视觉</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-08 11:53:24 / Modified: 15:46:16" itemprop="dateCreated datePublished" datetime="2019-05-08T11:53:24+09:00">2019-05-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/OpenCV/Projection/" itemprop="url" rel="index"><span itemprop="name">Projection</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Chapter-19"><a href="#Chapter-19" class="headerlink" title="Chapter 19"></a>Chapter 19</h1><p>首先会讨论从3D得到2D信息，然后再讨论从2D推断3D信息<br>如果没有多张图片是很难得到靠谱的3D信息的：</p>
<ul>
<li>通过stereo vision</li>
<li>通过motion</li>
</ul>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/05/08/OpenCV19/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/05/07/Leetcode笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/07/Leetcode笔记/" class="post-title-link" itemprop="url">Leetcode笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-07 21:57:42" itemprop="dateCreated datePublished" datetime="2019-05-07T21:57:42+09:00">2019-05-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-05-09 18:07:32" itemprop="dateModified" datetime="2019-05-09T18:07:32+09:00">2019-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/算法/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/算法/Leetcode/" itemprop="url" rel="index"><span itemprop="name">Leetcode</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-twoSum"><a href="#1-twoSum" class="headerlink" title="#1 twoSum"></a>#1 twoSum</h2><p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p>
<p>You may assume that each input would have exactly one solution, and you may not use the same element twice.</p>
<p>Example:</p>
<p>Given nums = [2, 7, 11, 15], target = 9,</p>
<p>Because nums[0] + nums[1] = 2 + 7 = 9,<br>return [0, 1].</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums: List[int], target: int)</span> -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            <span class="keyword">if</span> target - item <span class="keyword">in</span> nums <span class="keyword">and</span> nums.index(target - item) != i:</span><br><span class="line">                <span class="keyword">return</span> [i, nums.index(target - item)]</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ul>
<li>刚开始用了直接for所有的元素的方法，忘记考虑当两个数字重复的时候需要怎么办，考虑了之后在非常大的数的情况下爆炸了</li>
<li>标准答案说到了hash表，但是其实在python实现里面本身就是个hash（不然怎么从索引得到结果），不需要考虑这个问题</li>
<li>然后考虑了把所有东西都放一个dict里面（毕竟hash？），但是遇到的问题是从value直接得到key会生一些问题。如果把数字作为key，索引作为value会发现数字有重复的，会覆盖key的值</li>
<li>这时候突然发现，如果用数字作为索引的话其实dict和list没有本质区别，在list里面操作就行了，而且list的<code>.index()</code>可以直接返回这个值得坐标（找到的是第一个值！！）</li>
<li>所以直接用enumerate把所有的index和item都列出来就可以解决了，神奇。</li>
</ul>
<h2 id="27-remove-element"><a href="#27-remove-element" class="headerlink" title="#27 remove element"></a>#27 remove element</h2><p>Given an array nums and a value val, remove all instances of that value in-place and return the new length.</p>
<p>Do not allocate extra space for another array, you must do this by modifying the input array in-place with O(1) extra memory.</p>
<p>The order of elements can be changed. It doesn’t matter what you leave beyond the new length.</p>
<p>Example 1:</p>
<p>Given nums = [3, 2, 2, 3], val = 3,</p>
<p>Your function should return length = 2, with the first two elements of nums being 2.</p>
<p>It doesn’t matter what you leave beyond the returned length.<br>Example 2:</p>
<p>Given nums = [0, 1, 2, 2, 3, 0, 4, 2], val = 2,</p>
<p>Your function should return length = 5, with the first five elements of nums containing 0, 1, 3, 0, and 4.</p>
<p>Note that the order of those five elements can be arbitrary.</p>
<p>It doesn’t matter what values are set beyond the returned length.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeElement</span><span class="params">(self, nums: List[int], val: int)</span> -&gt; int:</span></span><br><span class="line">        remove_nums = <span class="number">0</span></span><br><span class="line">        ori_length = len(nums)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">if</span> nums[i] == val:</span><br><span class="line">                remove_nums += <span class="number">1</span></span><br><span class="line">                nums[i] = float(<span class="string">'inf'</span>)</span><br><span class="line">        nums.sort()</span><br><span class="line">        nums = nums[:ori_length - remove_nums]</span><br><span class="line">        <span class="keyword">return</span> len(nums)</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ul>
<li>这道题的重点是需要in - place的处理，空间复杂度要求很高（然而我的空间结果很垃圾）。一个重点就是返回的list不需要按照原来的顺序排列</li>
<li>从不需要原来的顺序得到的思路是：我把需要删除的东西的位置改成了inf，然后对所有部分进行排序，得到排序之后的结果再进行切片（这里刚开始的思路是删掉这个地方的东西然后再insert，后来发现直接替换就好了）</li>
<li>其实也可以直接用交换位置的方法，不用切片，因为题目只需要前面的这些元素符合要求就可以了，没有说后面的怎么样。</li>
<li>看了一些discussion都是memory只比5 % 的人少。。。但是差距都不大应该没问题！</li>
</ul>
<p>看到了一个超级牛逼简要写法：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> val <span class="keyword">in</span> nums:</span><br><span class="line">    nums.remove(val)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> len(nums)</span><br></pre></td></tr></table></figure></p>
<h2 id="80"><a href="#80" class="headerlink" title="#80"></a>#80</h2><p>Given a sorted array nums, remove the duplicates in-place such that duplicates appeared at most twice and return the new length.</p>
<p>Do not allocate extra space for another array, you must do this by modifying the input array in-place with O(1) extra memory.</p>
<p>Example 1:</p>
<p>Given nums = [1,1,1,2,2,3],</p>
<p>Your function should return length = 5, with the first five elements of nums being 1, 1, 2, 2 and 3 respectively.</p>
<p>It doesn’t matter what you leave beyond the returned length.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span><span class="params">(self, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> i &gt;= len(nums) <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">if</span> len(nums) &gt; <span class="number">2</span> <span class="keyword">and</span> nums[i] == nums[i - <span class="number">2</span>]:</span><br><span class="line">                    nums = nums[:nums.index(nums[i])+<span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] == nums[i+<span class="number">1</span>]:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                next_num = nums[i+<span class="number">1</span>]</span><br><span class="line">                start_index = nums.index(nums[i])</span><br><span class="line">                next_index = nums.index(next_num)</span><br><span class="line">                <span class="keyword">if</span> next_index - start_index &gt; <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">for</span> l <span class="keyword">in</span> range(start_index+<span class="number">2</span>, next_index):</span><br><span class="line">                        nums[l] = float(<span class="string">'inf'</span>)</span><br><span class="line">                i = next_index</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> float(<span class="string">'inf'</span>) <span class="keyword">in</span> nums:</span><br><span class="line">            nums.remove(float(<span class="string">'inf'</span>))</span><br><span class="line">        <span class="keyword">return</span> len(nums)</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ul>
<li>我深信我的方法虽然蠢但是没有问题，但是跑出来就是有问题，分明我return之前的数据还都是对的，但是return之后显示的东西就都有问题了</li>
<li>主要思路是这样的<ul>
<li>因为in-place操作，所以就不能直接用remove去掉元素导致下标错乱</li>
<li>本来是想和上面的思路一样，换成inf，然后再把有inf的部分删除掉（参考了#27的简易解法）</li>
<li>怎么换成inf呢，我判断的方法是找到下一个值得index，然后计算这个index和上一个之间差多少个数，然后把富裕的数字都替换成inf</li>
</ul>
</li>
<li>忽略的问题：<ul>
<li>数数数错了很多问题</li>
<li>最开始没有考虑到什么停止</li>
<li>然后没有考虑到如果最后一个数字重复了两遍以上要怎么办的问题（这也是我用next_index的一个弊端）</li>
</ul>
</li>
</ul>
<p><strong>然后看着大佬的代码哭出了声！！！</strong><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span><span class="params">(self, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="number">2</span> <span class="keyword">or</span> n != nums[i<span class="number">-2</span>]:</span><br><span class="line">                nums[i] = n</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure></p>
<p>总结：</p>
<ul>
<li>哇这个思路真的牛逼！</li>
<li>中心思想就是让n来增加但是i不增加，这里已经说了不在意前面项之后list里面的内容，也就是说前n项之后的东西都不用管了。既然如此的话与其用inf来替换这个位置的数字，不如直接用后面的项填在相对应的位置上，只有填成功了才会增加i</li>
<li>这里需要<strong>先判断i的值是否小于2，然后再计算nums[i-2]，否则会out of range</strong></li>
<li>i跑的速度没有超过n跑的速度所以没有关系</li>
<li>合理利用题里面的条件限制真的很重要！！</li>
</ul>
<h2 id="189-Rotate-array"><a href="#189-Rotate-array" class="headerlink" title="#189 Rotate array"></a>#189 Rotate array</h2><p>Given an array, rotate the array to the right by k steps, where k is non-negative.</p>
<p>Example 1:</p>
<p>Input: [1,2,3,4,5,6,7] and k = 3<br>Output: [5,6,7,1,2,3,4]<br>Explanation:<br>rotate 1 steps to the right: [7,1,2,3,4,5,6]<br>rotate 2 steps to the right: [6,7,1,2,3,4,5]<br>rotate 3 steps to the right: [5,6,7,1,2,3,4]</p>
<p>Example 2:</p>
<p>Input: [-1,-100,3,99] and k = 2<br>Output: [3,99,-1,-100]<br>Explanation:<br>rotate 1 steps to the right: [99,-1,-100,3]<br>rotate 2 steps to the right: [3,99,-1,-100]</p>
<p>Note:</p>
<p>Try to come up as many solutions as you can, there are at least 3 different ways to solve this problem.<br>Could you do it in-place with O(1) extra space?</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>需不需要注意k = 0的时候</li>
<li>如果k的个数特别大需不需要简化一下</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span><span class="params">(self, nums: List[int], k: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        steps = k % len(nums)</span><br><span class="line">        unchange_nums = nums[:len(nums) - steps]</span><br><span class="line">        change_nums = nums[len(nums) - steps : ]</span><br><span class="line">        nums[:steps] = change_nums</span><br><span class="line">        nums[steps:] = unchange_nums</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ul>
<li>居然第一种就这么写出来了，实际上就是把后面的数字移动到前面去</li>
<li>注意nums不能直接用change_nums + unchange_nums，大概是他认为这个不是in-place了吧</li>
</ul>
<h3 id="另一种方法：in-place"><a href="#另一种方法：in-place" class="headerlink" title="另一种方法：in-place"></a>另一种方法：in-place</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    k = k % len(nums)</span><br><span class="line">    self.reverse_nums(nums,<span class="number">0</span>,len(nums) - <span class="number">1</span>)</span><br><span class="line">    self.reverse_nums(nums,<span class="number">0</span>,k<span class="number">-1</span>)</span><br><span class="line">    self.reverse_nums(nums,k,len(nums) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_nums</span><span class="params">(self,nums,start,end)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> start &lt; end:</span><br><span class="line">        temp = nums[start]</span><br><span class="line">        nums[start] = nums[end]</span><br><span class="line">        nums[end] = temp</span><br><span class="line">        start += <span class="number">1</span></span><br><span class="line">        end -= <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>实际上，rotate的另外一种方法是先把整个list反向，然后把前面的k个反向，然后再把后面的(n-k)个反向（这里我是没想到的）</li>
<li>把一个数组反向的算法就是从两头向中间逼近着交换（我该好好去看看基础的算法了。。）</li>
<li>最后，还有一种方法是跳着设置值，也就是说k个之后的值就应该是现在这个位置的值</li>
</ul>
<h2 id="41-First-Missing-Positive"><a href="#41-First-Missing-Positive" class="headerlink" title="#41 First Missing Positive"></a>#41 First Missing Positive</h2><p>Given an unsorted integer array, find the smallest missing positive integer.</p>
<p>Example 1:</p>
<p>Input: [1,2,0]<br>Output: 3<br>Example 2:</p>
<p>Input: [3,4,-1,1]<br>Output: 2<br>Example 3:</p>
<p>Input: [7,8,9,11,12]<br>Output: 1<br>Note:</p>
<p>Your algorithm should run in O(n) time and uses constant extra space.</p>
<h3 id="第一个思路：时间nlog-n"><a href="#第一个思路：时间nlog-n" class="headerlink" title="第一个思路：时间nlog(n)"></a>第一个思路：时间nlog(n)</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstMissingPositive</span><span class="params">(self, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        nums.sort()</span><br><span class="line">        target = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> n == target:</span><br><span class="line">                target += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> target</span><br></pre></td></tr></table></figure>
<ul>
<li>这个思路整体建立在先排序的基础上，但是排序的时间复杂度本身就已经是nlog(n)了</li>
<li>排序 - 找到比0大的数字从这里开始 - 这个数字不符合的话找下一个<ul>
<li>但是我在找比0大的数字的时候还想着把list切片，切片就又需要考虑0啊，1啊，缺多少个数字的问题，空的list。其实根本不用这么麻烦</li>
<li>本质上这个方法就是，找到miss的正数，那就从正数的第一个（1）开始找，如果找到了这个数就继续找下一个（target++），总是能找到的嘛，找到的就是缺的数字了</li>
</ul>
</li>
</ul>
<hr>
<p><strong>自己的方法</strong><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstMissingPositive</span><span class="params">(self, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> nums <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> len(nums) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            target_num = i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> nums[i] == target_num:</span><br><span class="line">                <span class="keyword">if</span> i == len(nums) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> target_num + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> target_num <span class="keyword">in</span> nums:</span><br><span class="line">                temp = nums.index(target_num)</span><br><span class="line">                nums[temp],nums[i] = nums[i], nums[temp]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> target_num</span><br></pre></td></tr></table></figure></p>
<ul>
<li>桶排序：要把对应的数字放在对应的位置上<ul>
<li>这道题里应该的样子就是nums[index] = index + 1</li>
</ul>
</li>
<li>大佬的思路 -&gt; 首先判断边界条件！！(学到了学到了)</li>
<li>看过了上面的提示写出来的第二版<ul>
<li>判断边界条件</li>
<li>判断这个数字是不是摆在了正确的位置<ul>
<li>正确，判断是否是最后一个数字<ul>
<li>是，输出的是最后一个数字+1</li>
<li>不是，这个位置的正确了，判断下一个位置</li>
</ul>
</li>
<li>没有，判断nums里面还有没有应该摆在这个位置的数字<ul>
<li>有，那就和这个位置交换</li>
<li>没有，那没有的数字就是缺少的数字了</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>因为每次都是把数字换到了正确的位置了，所以交换最多进行len(nums)次，时间复杂度是O(n)</li>
</ul>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">firstMissingPositive</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(nums)):</span><br><span class="line">        <span class="keyword">while</span> <span class="number">0</span> &lt;= nums[i]<span class="number">-1</span> &lt; len(nums) <span class="keyword">and</span> nums[nums[i]<span class="number">-1</span>] != nums[i]:</span><br><span class="line">            tmp = nums[i]<span class="number">-1</span></span><br><span class="line">            nums[i], nums[tmp] = nums[tmp], nums[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(nums)):</span><br><span class="line">        <span class="keyword">if</span> nums[i] != i+<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> len(nums)+<span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>大佬的另一个方法，其实思路和上面的差不多，就是把数字换到正确的位置上，但是判断的条件和我的有一点不同，可能因为我的是基于python的功能</li>
<li>其中，换到正确位置的数字就是在1到len(nums)之间的数字。nums[i]-1是这个数字应该的坐标位置，如果应该的位置和现在的位置的数字不一样，那就交换这两个数字<ul>
<li>注意这里需要用while换，要一直换到正确的位置才可以</li>
</ul>
</li>
<li>这样的结果就是大家都按正确的填好了，最后不对的那个位置的index+1就是需要的结果</li>
</ul>
<h2 id="299"><a href="#299" class="headerlink" title="#299"></a>#299</h2><p>You are playing the following Bulls and Cows game with your friend: You write down a number and ask your friend to guess what the number is. Each time your friend makes a guess, you provide a hint that indicates how many digits in said guess match your secret number exactly in both digit and position (called “bulls”) and how many digits match the secret number but locate in the wrong position (called “cows”). Your friend will use successive guesses and hints to eventually derive the secret number.</p>
<p>Write a function to return a hint according to the secret number and friend’s guess, use A to indicate the bulls and B to indicate the cows. </p>
<p>Please note that both secret number and friend’s guess may contain duplicate digits.</p>
<p>Example 1:</p>
<p>Input: secret = “1807”, guess = “7810”</p>
<p>Output: “1A3B”</p>
<p>Explanation: 1 bull and 3 cows. The bull is 8, the cows are 0, 1 and 7.<br>Example 2:</p>
<p>Input: secret = “1123”, guess = “0111”</p>
<p>Output: “1A1B”</p>
<p>Explanation: The 1st 1 in friend’s guess is a bull, the 2nd or 3rd 1 is a cow.<br>Note: You may assume that the secret number and your friend’s guess only contain digits, and their lengths are always equal.</p>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getHint</span><span class="params">(self, secret: str, guess: str)</span> -&gt; str:</span></span><br><span class="line">        bull = sum(a == b <span class="keyword">for</span> a,b <span class="keyword">in</span> zip(secret,guess))</span><br><span class="line">        cow = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> set(guess):</span><br><span class="line">            cow  += min(secret.count(x),guess.count(x))        </span><br><span class="line">        <span class="keyword">return</span> str(bull) + <span class="string">"A"</span> + str(cow-bull) + <span class="string">"B"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里自己想了一些比较蠢的想法之后直接参考别人的了<ul>
<li>其一是比对他们两个位置和数字都相同的东西，想要转换成dict来比较，但是后来发现string就可以直接index了不用这么麻烦</li>
<li>想过能不能按位做减法，未果</li>
<li>其二是在得到了bull之后把bull的部分从原来的里面剔除出去然后再比较相似的数字</li>
</ul>
</li>
<li>遇到了主要问题是重复的数字怎么办以及如何剔除出去bull</li>
<li>主要思路是这样的：<ul>
<li>其实cow的数量就是bull-cow都是的数量减去bull的数量，也就相当于维恩图里面，只有A的量是A的量 - 同时AB的量。这里是bull就相当于AB都有，两个里面所有重复的数量就相当于A的量<ul>
<li>这样可以做减法就解决了上面的从bull得到cow的问题！！</li>
<li>所以说看问题还是要看本质</li>
</ul>
</li>
<li>面对重复的数字，居然可以直接把string转换成set<ul>
<li>这里复习一下set好吗！！！这个集合居然可以没有重复的元素，平常我忽视你了呀小可爱，转化成set就不会重复了哦，震惊！！</li>
</ul>
</li>
<li>这样问题就变成了：<ul>
<li>求bull：用<strong>zip</strong>把两个东西一一对应的打包起来（居然还有你小可爱！）直接对比</li>
<li>求both：guess里面猜的次数就是总体的次数，secret里面的次数是真实的次数，对于每个在guess里面（set）的元素都看看分别在两个里面是多少个，然后小的那个就是both的大小<ul>
<li>这里介绍<code>.count()</code>小可爱，居然还可以数数！</li>
</ul>
</li>
<li>最后both-bull就是结果了</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/05/07/CS231nassignment2Pytorch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/07/CS231nassignment2Pytorch/" class="post-title-link" itemprop="url">CS231Nassignment2之Pytorch</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-07 13:25:38 / Modified: 18:15:35" itemprop="dateCreated datePublished" datetime="2019-05-07T13:25:38+09:00">2019-05-07</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/CS231n作业/" itemprop="url" rel="index"><span itemprop="name">CS231n作业</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这部分需要在torch和TensorFlow两个framework里面选一个。</p>
<h1 id="PyTorch"><a href="#PyTorch" class="headerlink" title="PyTorch"></a>PyTorch</h1><h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><ul>
<li>加入了Tensor的object（类似于narray），不需要手动的backprop了</li>
</ul>
<h1 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h1><ul>
<li>在GPU上面跑，不需要CUDA就可以在自己的GPU上面跑NN</li>
<li>functions很多</li>
<li>站在巨人的肩膀上！</li>
<li>在实际使用中应该写的深度学习代码</li>
</ul>
<h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul>
<li>Justin Johnson has made an excellent<a href="https://github.com/jcjohnson/pytorch-examples" target="_blank" rel="noopener">tutorial</a> for PyTorch.</li>
<li>Detailed<a href="http: // pytorch.org / docs / stable / index.html" target="_blank" rel="noopener">API doc</a></li>
<li>If you have other questions that are not addressed by the API docs, the <a href="https: // discuss.pytorch.org /" target="_blank" rel="noopener">PyTorch forum</a> is a much better place to ask than StackOverflow.</li>
</ul>
<h2 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h2><ul>
<li>第一部分，准备，使用dataset</li>
<li>第二部分，abstraction level1，直接在最底层的Tensors上面操作</li>
<li>第三部分，abstraction level2，<code>nn.Module</code>定义一个任意的NN结构</li>
<li>第四部分，abstraction level3，<code>nn.Sequential</code>，定义一个简单的线性feed - back网络</li>
<li>第五部分，自己调参，尽量让CIFAR - 10的精度尽可能高</li>
</ul>
<h2 id="Part-1-Preparation"><a href="#Part-1-Preparation" class="headerlink" title="Part 1.Preparation"></a>Part 1.Preparation</h2><p>pytorch里面有下载dataset，预处理并且迭代成minibatch的功能</p>
<p><code>import torchvision.transforms as T</code></p>
<ul>
<li>这个包包括了预处理以及增强data的功能，在这里选择了减去平均的RGB并且除以标准差</li>
<li>然后对不同的部分分别构建了一个dataset object（训练，测试，val），这个dataset会载入一次training example，并且在DataLoader部分构建minibatch</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">NUM_TRAIN = <span class="number">49000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The torchvision.transforms package provides tools for preprocessing data</span></span><br><span class="line"><span class="comment"># and for performing data augmentation; here we set up a transform to</span></span><br><span class="line"><span class="comment"># preprocess the data by subtracting the mean RGB value and dividing by the</span></span><br><span class="line"><span class="comment"># standard deviation of each RGB value; we've hardcoded the mean and std.</span></span><br><span class="line">transform = T.Compose([</span><br><span class="line">    T.ToTensor(),</span><br><span class="line">    T.Normalize((<span class="number">0.4914</span>, <span class="number">0.4822</span>, <span class="number">0.4465</span>), (<span class="number">0.2023</span>, <span class="number">0.1994</span>, <span class="number">0.2010</span>))</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># We set up a Dataset object for each split (train / val / test); Datasets load</span></span><br><span class="line"><span class="comment"># training examples one at a time, so we wrap each Dataset in a DataLoader which</span></span><br><span class="line"><span class="comment"># iterates through the Dataset and forms minibatches. We divide the CIFAR-10</span></span><br><span class="line"><span class="comment"># training set into train and val sets by passing a Sampler object to the</span></span><br><span class="line"><span class="comment"># DataLoader telling how it should sample from the underlying Dataset.</span></span><br><span class="line">cifar10_train = dset.CIFAR10(<span class="string">'./cs231n/datasets'</span>, train=<span class="literal">True</span>, download=<span class="literal">True</span>,</span><br><span class="line">                             transform=transform)</span><br><span class="line">loader_train = DataLoader(cifar10_train, batch_size=<span class="number">64</span>,</span><br><span class="line">                          sampler=sampler.SubsetRandomSampler(range(NUM_TRAIN)))</span><br><span class="line"></span><br><span class="line">cifar10_val = dset.CIFAR10(<span class="string">'./cs231n/datasets'</span>, train=<span class="literal">True</span>, download=<span class="literal">True</span>,</span><br><span class="line">                           transform=transform)</span><br><span class="line">loader_val = DataLoader(cifar10_val, batch_size=<span class="number">64</span>,</span><br><span class="line">                        sampler=sampler.SubsetRandomSampler(range(NUM_TRAIN, <span class="number">50000</span>)))</span><br><span class="line"></span><br><span class="line">cifar10_test = dset.CIFAR10(<span class="string">'./cs231n/datasets'</span>, train=<span class="literal">False</span>, download=<span class="literal">True</span>,</span><br><span class="line">                            transform=transform)</span><br><span class="line">loader_test = DataLoader(cifar10_test, batch_size=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>需要一个是否使用GPU的flag，并且set到true。在这个作业里面不是必须用GPU跑，但是如果电脑不能enableCUDA的话，<strong>就会自动返回CPU模式</strong>。</li>
<li>除此之外，建立了两个global var，dtype代表float32，device代表用哪个</li>
<li>因为mac本身不支持CUDA，而且好像新版本的系统还不能安装N卡的部分，所以现在用的CPU</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">USE_GPU = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">dtype = torch.float32  <span class="comment"># we will be using float throughout this tutorial</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> USE_GPU <span class="keyword">and</span> torch.cuda.is_available():</span><br><span class="line">    device = torch.device(<span class="string">'cuda'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    device = torch.device(<span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Constant to control how frequently we print train loss</span></span><br><span class="line">print_every = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'using device:'</span>, device)</span><br></pre></td></tr></table></figure>
<h2 id="Part2-Barebones-PyTorch"><a href="#Part2-Barebones-PyTorch" class="headerlink" title="Part2 Barebones PyTorch"></a>Part2 Barebones PyTorch</h2><ul>
<li>虽然有很多高层的API已经有了很多功能，但是这部分从比较底层的部分来进行</li>
<li>建立一个简单的fc - relu net，两个中间层，没有bias</li>
<li>用Tensor的method来计算forward，并且用自带的autograd来计算back</li>
<li>如果设定了<code>requires_grad = True</code>，那么在计算的时候不仅会计算值，还会生成计算back的graph</li>
<li>if x is a Tensor with <code>x.requires_grad == True</code> then after backpropagation x.grad will be another Tensor holding the gradient of x with respect to the scalar loss at the end</li>
</ul>
<h3 id="PyTorch-Tensors-Flatten-Function"><a href="#PyTorch-Tensors-Flatten-Function" class="headerlink" title="PyTorch Tensors: Flatten Function"></a>PyTorch Tensors: Flatten Function</h3><ul>
<li>Tensors是一个和narray很像的东西，定义了很多比较好用的功能，比如<code>flatten</code>来reshape image data</li>
<li>在Tensor里面一个图片的形状是NxCxHxW<ul>
<li>datapoint的数量</li>
<li>channels</li>
<li>feature map的H和W</li>
</ul>
</li>
<li>但是在affine里面我们希望一个datapoint可以表现成一个单独的vector，而不是channel和宽和高</li>
<li>所以在这里用flatten来首先读取NCHW的数据，然后返回这个data的view（<strong>相当于array里面的reshape，把它改成了Nx？？，其中？？可以是任何值</strong>）</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span><span class="params">(x)</span>:</span></span><br><span class="line">    N = x.shape[<span class="number">0</span>]  <span class="comment"># read in N, C, H, W</span></span><br><span class="line">    <span class="comment"># "flatten" the C * H * W values into a single vector per image</span></span><br><span class="line">    <span class="keyword">return</span> x.view(N, <span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Barebones-PyTorch-Two-Layer-Network"><a href="#Barebones-PyTorch-Two-Layer-Network" class="headerlink" title="Barebones PyTorch: Two-Layer Network"></a>Barebones PyTorch: Two-Layer Network</h3><p>当定义一个 two_layer_fc的时候，会有两层的中间带relu的forward，在写好了forward之后需要确保输出的形状是对的并且没有什么问题(最近好像对这个大小已经没有什么疑问了)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F  <span class="comment"># useful stateless functions</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_layer_fc</span><span class="params">(x, params)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A fully-connected neural networks; the architecture is:</span></span><br><span class="line"><span class="string">    NN is fully connected -&gt; ReLU -&gt; fully connected layer.</span></span><br><span class="line"><span class="string">    Note that this function only defines the forward pass; </span></span><br><span class="line"><span class="string">    PyTorch will take care of the backward pass for us.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The input to the network will be a minibatch of data, of shape</span></span><br><span class="line"><span class="string">    (N, d1, ..., dM) where d1 * ... * dM = D. The hidden layer will have H units,</span></span><br><span class="line"><span class="string">    and the output layer will produce scores for C classes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Inputs:</span></span><br><span class="line"><span class="string">    - x: A PyTorch Tensor of shape (N, d1, ..., dM) giving a minibatch of</span></span><br><span class="line"><span class="string">      input data.</span></span><br><span class="line"><span class="string">    - params: A list [w1, w2] of PyTorch Tensors giving weights for the network;</span></span><br><span class="line"><span class="string">      w1 has shape (D, H) and w2 has shape (H, C).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    - scores: A PyTorch Tensor of shape (N, C) giving classification scores for</span></span><br><span class="line"><span class="string">      the input data x.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># first we flatten the image</span></span><br><span class="line">    x = flatten(x)  <span class="comment"># shape: [batch_size, C x H x W]</span></span><br><span class="line"></span><br><span class="line">    w1, w2 = params</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Forward pass: compute predicted y using operations on Tensors. Since w1 and</span></span><br><span class="line">    <span class="comment"># w2 have requires_grad=True, operations involving these Tensors will cause</span></span><br><span class="line">    <span class="comment"># PyTorch to build a computational graph, allowing automatic computation of</span></span><br><span class="line">    <span class="comment"># gradients. Since we are no longer implementing the backward pass by hand we</span></span><br><span class="line">    <span class="comment"># don't need to keep references to intermediate values.</span></span><br><span class="line">    <span class="comment"># you can also use `.clamp(min=0)`, equivalent to F.relu()</span></span><br><span class="line">    x = F.relu(x.mm(w1))</span><br><span class="line">    x = x.mm(w2)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">two_layer_fc_test</span><span class="params">()</span>:</span></span><br><span class="line">    hidden_layer_size = <span class="number">42</span></span><br><span class="line">    <span class="comment"># minibatch size 64, feature dimension 50</span></span><br><span class="line">    x = torch.zeros((<span class="number">64</span>, <span class="number">50</span>), dtype=dtype)</span><br><span class="line">    w1 = torch.zeros((<span class="number">50</span>, hidden_layer_size), dtype=dtype)</span><br><span class="line">    w2 = torch.zeros((hidden_layer_size, <span class="number">10</span>), dtype=dtype)</span><br><span class="line">    scores = two_layer_fc(x, [w1, w2])</span><br><span class="line">    print(scores.size())  <span class="comment"># you should see [64, 10]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">two_layer_fc_test()</span><br></pre></td></tr></table></figure>
<h3 id="Barebones-PyTorch-Three-Layer-ConvNet"><a href="#Barebones-PyTorch-Three-Layer-ConvNet" class="headerlink" title="Barebones PyTorch: Three-Layer ConvNet"></a>Barebones PyTorch: Three-Layer ConvNet</h3><ul>
<li>上下这两个都是，在测试的时候可以直接pass 0来测试tensor的大小是不是对的</li>
<li>网络的结构<ul>
<li>conv with bias，channel_1 filters，KW1xKH1，2 zero - padding</li>
<li>RELU</li>
<li>conv with bias，channel_2 filters，KW2xKH2，1 zero - padding</li>
<li>RELU</li>
<li>fc with bias，输出C class</li>
</ul>
</li>
<li>注意！在这里fc之后没有softmax的激活层，因为在后面计算loss的时候会提供softmax，计算起来更加有效率</li>
<li>注意2！在conv2d之前不需要flatten，在fc之前才需要flatten</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">three_layer_convnet</span><span class="params">(x, params)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Performs the forward pass of a three-layer convolutional network with the</span></span><br><span class="line"><span class="string">    architecture defined above.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Inputs:</span></span><br><span class="line"><span class="string">    - x: A PyTorch Tensor of shape (N, 3, H, W) giving a minibatch of images</span></span><br><span class="line"><span class="string">    - params: A list of PyTorch Tensors giving the weights and biases for the</span></span><br><span class="line"><span class="string">      network; should contain the following:</span></span><br><span class="line"><span class="string">      - conv_w1: PyTorch Tensor of shape (channel_1, 3, KH1, KW1) giving weights</span></span><br><span class="line"><span class="string">        for the first convolutional layer</span></span><br><span class="line"><span class="string">      - conv_b1: PyTorch Tensor of shape (channel_1,) giving biases for the first</span></span><br><span class="line"><span class="string">        convolutional layer</span></span><br><span class="line"><span class="string">      - conv_w2: PyTorch Tensor of shape (channel_2, channel_1, KH2, KW2) giving</span></span><br><span class="line"><span class="string">        weights for the second convolutional layer</span></span><br><span class="line"><span class="string">      - conv_b2: PyTorch Tensor of shape (channel_2,) giving biases for the second</span></span><br><span class="line"><span class="string">        convolutional layer</span></span><br><span class="line"><span class="string">      - fc_w: PyTorch Tensor giving weights for the fully-connected layer. Can you</span></span><br><span class="line"><span class="string">        figure out what the shape should be? (N,channel_2*H*W)</span></span><br><span class="line"><span class="string">      - fc_b: PyTorch Tensor giving biases for the fully-connected layer. Can you</span></span><br><span class="line"><span class="string">        figure out what the shape should be? (C,)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    - scores: PyTorch Tensor of shape (N, C) giving classification scores for x</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    conv_w1, conv_b1, conv_w2, conv_b2, fc_w, fc_b = params</span><br><span class="line">    scores = <span class="literal">None</span></span><br><span class="line">    <span class="comment">################################################################################</span></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> Implement the forward pass for the three-layer ConvNet.                #</span></span><br><span class="line">    <span class="comment">################################################################################</span></span><br><span class="line">    <span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line">    x = nn.functional.conv2d(x, conv_w1, bias=conv_b1, padding=<span class="number">2</span>)</span><br><span class="line">    x = nn.functional.conv2d(F.relu(x), conv_w2, bias=conv_b2, padding=<span class="number">1</span>)</span><br><span class="line">    x = flatten(x)</span><br><span class="line">    x = x.mm(fc_w) + fc_b</span><br><span class="line">    scores = x</span><br><span class="line"></span><br><span class="line">    <span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line">    <span class="comment">################################################################################</span></span><br><span class="line">    <span class="comment">#                                 END OF YOUR CODE                             #</span></span><br><span class="line">    <span class="comment">################################################################################</span></span><br><span class="line">    <span class="keyword">return</span> scores</span><br></pre></td></tr></table></figure>
<h3 id="Barebones-PyTorch-Initialization"><a href="#Barebones-PyTorch-Initialization" class="headerlink" title="Barebones PyTorch: Initialization"></a>Barebones PyTorch: Initialization</h3><ul>
<li><code>random_weight(shape)</code> initializes a weight tensor with the Kaiming normalization method. -&gt; 使用了KAIMING normal</li>
<li><code>zero_weight(shape)</code> initializes a weight tensor with all zeros. Useful for instantiating bias parameters.</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_weight</span><span class="params">(shape)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create random Tensors for weights; setting requires_grad=True means that we</span></span><br><span class="line"><span class="string">    want to compute gradients for these Tensors during the backward pass.</span></span><br><span class="line"><span class="string">    We use Kaiming normalization: sqrt(2 / fan_in)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> len(shape) == <span class="number">2</span>:  <span class="comment"># FC weight</span></span><br><span class="line">        fan_in = shape[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># conv weight [out_channel, in_channel, kH, kW]</span></span><br><span class="line">        fan_in = np.prod(shape[<span class="number">1</span>:])</span><br><span class="line">    <span class="comment"># randn is standard normal distribution generator.</span></span><br><span class="line">    w = torch.randn(shape, device=device, dtype=dtype) * np.sqrt(<span class="number">2.</span> / fan_in)</span><br><span class="line">    w.requires_grad = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zero_weight</span><span class="params">(shape)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> torch.zeros(shape, device=device, dtype=dtype, requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># create a weight of shape [3 x 5]</span></span><br><span class="line"><span class="comment"># you should see the type `torch.cuda.FloatTensor` if you use GPU.</span></span><br><span class="line"><span class="comment"># Otherwise it should be `torch.FloatTensor`</span></span><br><span class="line">random_weight((<span class="number">3</span>, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<h3 id="Barebones-PyTorch-Check-Accuracy"><a href="#Barebones-PyTorch-Check-Accuracy" class="headerlink" title="Barebones PyTorch: Check Accuracy"></a>Barebones PyTorch: Check Accuracy</h3><ul>
<li>在这部分不需要计算grad，所以要关上<code>torch.no_grad()</code>避免浪费</li>
<li>输入<ul>
<li>一个DataLoader来给我们想要check的data分块</li>
<li>一个表示模型到底是什么样子的model_fn，来计算预测的scores</li>
<li>这个model需要的参数</li>
</ul>
</li>
<li>没有返回值但是会print出来acc</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_accuracy_part2</span><span class="params">(loader, model_fn, params)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Check the accuracy of a classification model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Inputs:</span></span><br><span class="line"><span class="string">    - loader: A DataLoader for the data split we want to check</span></span><br><span class="line"><span class="string">    - model_fn: A function that performs the forward pass of the model,</span></span><br><span class="line"><span class="string">      with the signature scores = model_fn(x, params)</span></span><br><span class="line"><span class="string">    - params: List of PyTorch Tensors giving parameters of the model</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns: Nothing, but prints the accuracy of the model</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    split = <span class="string">'val'</span> <span class="keyword">if</span> loader.dataset.train <span class="keyword">else</span> <span class="string">'test'</span></span><br><span class="line">    print(<span class="string">'Checking accuracy on the %s set'</span> % split)</span><br><span class="line">    num_correct, num_samples = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> loader:</span><br><span class="line">            x = x.to(device=device, dtype=dtype)  <span class="comment"># move to device, e.g. GPU</span></span><br><span class="line">            y = y.to(device=device, dtype=torch.int64)</span><br><span class="line">            scores = model_fn(x, params)</span><br><span class="line">            _, preds = scores.max(<span class="number">1</span>)</span><br><span class="line">            num_correct += (preds == y).sum()</span><br><span class="line">            num_samples += preds.size(<span class="number">0</span>)</span><br><span class="line">        acc = float(num_correct) / num_samples</span><br><span class="line">        print(<span class="string">'Got %d / %d correct (%.2f%%)'</span> %</span><br><span class="line">              (num_correct, num_samples, <span class="number">100</span> * acc))</span><br></pre></td></tr></table></figure>
<h3 id="BareBones-PyTorch-Training-Loop"><a href="#BareBones-PyTorch-Training-Loop" class="headerlink" title="BareBones PyTorch: Training Loop"></a>BareBones PyTorch: Training Loop</h3><ul>
<li>用stochastic gradient descent without momentum来train，并且用<code>torch.functional.cross_entropy</code>来计算loss</li>
<li>输入<ul>
<li>model_fc</li>
<li>params</li>
<li>learning_rate</li>
</ul>
</li>
<li>没有输出</li>
<li>进行的操作<ul>
<li>把data移动到GPU或者CPU</li>
<li>计算score和loss</li>
<li>loss.backward()</li>
<li>update params，这部分不需要计算grad</li>
</ul>
</li>
</ul>
<h3 id="BareBones-PyTorch-Training-a-ConvNet"><a href="#BareBones-PyTorch-Training-a-ConvNet" class="headerlink" title="BareBones PyTorch: Training a ConvNet"></a>BareBones PyTorch: Training a ConvNet</h3><ul>
<li>需要网络<ol>
<li>Convolutional layer(with bias) with 32 5x5 filters, with zero - padding of 2</li>
<li>ReLU</li>
<li>Convolutional layer(with bias) with 16 3x3 filters, with zero - padding of 1</li>
<li>ReLU</li>
<li>Fully - connected layer(with bias) to compute scores for 10 classes</li>
</ol>
</li>
<li>需要自己初始化参数，不需要tune hypers<ul>
<li>注意1：fc的w的大小是D,C，跟数据无关需要从上一层的输出求</li>
<li>conv之后的图片大小从32-&gt; 30</li>
</ul>
</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">learning_rate = <span class="number">3e-3</span></span><br><span class="line"></span><br><span class="line">channel_1 = <span class="number">32</span></span><br><span class="line">channel_2 = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">conv_w1 = <span class="literal">None</span></span><br><span class="line">conv_b1 = <span class="literal">None</span></span><br><span class="line">conv_w2 = <span class="literal">None</span></span><br><span class="line">conv_b2 = <span class="literal">None</span></span><br><span class="line">fc_w = <span class="literal">None</span></span><br><span class="line">fc_b = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> Initialize the parameters of a three-layer ConvNet.                    #</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line">conv_w1 = random_weight((channel_1, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">conv_b1 = zero_weight(channel_1)</span><br><span class="line">conv_w2 = random_weight((channel_2, channel_1, <span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">conv_b2 = zero_weight(channel_2)</span><br><span class="line">fc_w = random_weight((channel_2 * <span class="number">30</span> * <span class="number">30</span>, <span class="number">10</span>))</span><br><span class="line">fc_b = zero_weight(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"></span><br><span class="line">params = [conv_w1, conv_b1, conv_w2, conv_b2, fc_w, fc_b]</span><br><span class="line">train_part2(three_layer_convnet, params, learning_rate)</span><br></pre></td></tr></table></figure>
<h2 id="Part3-PyTorch-Module-API"><a href="#Part3-PyTorch-Module-API" class="headerlink" title="Part3 PyTorch Module API"></a>Part3 PyTorch Module API</h2><ul>
<li>上面的所有过程是手算来track整个过程的，但是在更大的net里面就没有什么用了</li>
<li><code>nn.Module</code>来定义网络，并且可以选optmi的方法</li>
</ul>
<ol>
<li><p>Subclass <code>nn.Module</code>. Give your network class an intuitive name like <code>TwoLayerFC</code>. </p>
</li>
<li><p><code>__init__()</code>里面定义自己需要的所有层.  <code>nn.Linear</code> and <code>nn.Conv2d</code> 都在模块里自带了. <code>nn.Module</code> will track these internal parameters for you. Refer to the <a href="http://pytorch.org/docs/master/nn.html" target="_blank" rel="noopener">doc</a> to learn more about the dozens of builtin layers. <strong>Warning</strong>: don’t forget to call the <code>super().__init__()</code> first!（调用父类）</p>
</li>
<li><p>In the <code>forward()</code> method, define the <em>connectivity</em> of your network. 直接用init里面初始化好的方法来forward，不要再forward里面增加新的方法</p>
</li>
</ol>
<h3 id="用上面的方法来写一个三层的layer"><a href="#用上面的方法来写一个三层的layer" class="headerlink" title="用上面的方法来写一个三层的layer"></a>用上面的方法来写一个三层的layer</h3><ul>
<li>注意需要初始化w和b的参数，用kaiming的方法</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreeLayerConvNet</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, in_channel, channel_1, channel_2, num_classes)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> Set up the layers you need for a three-layer ConvNet with the  #</span></span><br><span class="line">        <span class="comment"># architecture defined above.                                          #</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line">        self.conv_1 = nn.Conv2d(in_channel,channel_1,<span class="number">5</span>,stride=<span class="number">1</span>, padding=<span class="number">2</span>,bias=<span class="literal">True</span>)</span><br><span class="line">        nn.init.kaiming_normal_(self.conv_1.weight)</span><br><span class="line">        nn.init.constant_(self.conv_1.bias, <span class="number">0</span>)</span><br><span class="line">        self.conv_2 = nn.Conv2d(channel_1,channel_2,<span class="number">3</span>,stride=<span class="number">1</span>, padding=<span class="number">1</span>,bias=<span class="literal">True</span>)</span><br><span class="line">        nn.init.kaiming_normal_(self.conv_2.weight)</span><br><span class="line">        nn.init.constant_(self.conv_2.bias, <span class="number">0</span>)</span><br><span class="line">        self.fc_3 = nn.Linear(channel_2 * <span class="number">32</span> * <span class="number">32</span> , num_classes)</span><br><span class="line">        nn.init.kaiming_normal_(self.fc_3.weight)</span><br><span class="line">        nn.init.constant_(self.fc_3.bias, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment">#                          END OF YOUR CODE                            #       </span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        scores = <span class="literal">None</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> Implement the forward function for a 3-layer ConvNet. you      #</span></span><br><span class="line">        <span class="comment"># should use the layers you defined in __init__ and specify the        #</span></span><br><span class="line">        <span class="comment"># connectivity of those layers in forward()                            #</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line">        x = self.conv_1(x)</span><br><span class="line">        x = self.conv_2(F.relu(x))</span><br><span class="line">        x = flatten(F.relu(x))</span><br><span class="line">        x = self.fc_3(x)</span><br><span class="line">        scores = x</span><br><span class="line"></span><br><span class="line">        <span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="comment">#                             END OF YOUR CODE                         #</span></span><br><span class="line">        <span class="comment">########################################################################</span></span><br><span class="line">        <span class="keyword">return</span> scores</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_ThreeLayerConvNet</span><span class="params">()</span>:</span></span><br><span class="line">    x = torch.zeros((<span class="number">64</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>), dtype=dtype)  <span class="comment"># minibatch size 64, image size [3, 32, 32]</span></span><br><span class="line">    model = ThreeLayerConvNet(in_channel=<span class="number">3</span>, channel_1=<span class="number">12</span>, channel_2=<span class="number">8</span>, num_classes=<span class="number">10</span>)</span><br><span class="line">    scores = model(x)</span><br><span class="line">    print(scores.size())  <span class="comment"># you should see [64, 10]</span></span><br><span class="line">test_ThreeLayerConvNet()</span><br></pre></td></tr></table></figure>
<h3 id="Module-API-Check-Accuracy"><a href="#Module-API-Check-Accuracy" class="headerlink" title="Module API: Check Accuracy"></a>Module API: Check Accuracy</h3><ul>
<li>不用手动pass参数了，直接就可以得到整个net的acc</li>
</ul>
<h3 id="Module-API-Training-Loop"><a href="#Module-API-Training-Loop" class="headerlink" title="Module API: Training Loop"></a>Module API: Training Loop</h3><ul>
<li>用optimizer这个object来update weights</li>
<li>输入<ul>
<li>model</li>
<li>optimizer</li>
<li>epoch，可选</li>
</ul>
</li>
<li>没有return，但是会打印出来training时候的acc</li>
</ul>
<p>其实就是设置好model和optimizer就可以了</p>
<h2 id="Part4-PyTorch-Sequential-API"><a href="#Part4-PyTorch-Sequential-API" class="headerlink" title="Part4 PyTorch Sequential API"></a>Part4 PyTorch Sequential API</h2><ul>
<li><code>nn.Sequential</code>没有上面的灵活，但是可以集成上面的一串功能</li>
<li>需要提前定义一个在forward里面能用的flatten</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We need to wrap `flatten` function in a module in order to stack it</span></span><br><span class="line"><span class="comment"># in nn.Sequential</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flatten</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> flatten(x)</span><br><span class="line"></span><br><span class="line">hidden_layer_size = <span class="number">4000</span></span><br><span class="line">learning_rate = <span class="number">1e-2</span></span><br><span class="line"></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    Flatten(),</span><br><span class="line">    nn.Linear(<span class="number">3</span> * <span class="number">32</span> * <span class="number">32</span>, hidden_layer_size),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Linear(hidden_layer_size, <span class="number">10</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># you can use Nesterov momentum in optim.SGD</span></span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=learning_rate,</span><br><span class="line">                     momentum=<span class="number">0.9</span>, nesterov=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train_part34(model, optimizer)</span><br></pre></td></tr></table></figure>
<h3 id="实现三层，注意需要初始化参数"><a href="#实现三层，注意需要初始化参数" class="headerlink" title="实现三层，注意需要初始化参数"></a>实现三层，注意需要初始化参数</h3><ul>
<li>这里遇到了一个问题是当用random_weight实现的时候，acc会特别低</li>
<li>从<a href="https://github.com/haofeixu/cs231n/blob/master/assignment2/PyTorch.ipynb" target="_blank" rel="noopener">这里</a>发现可以重新定义另一个计算方法不同的weights</li>
<li>从<a href="http://pytorch.org/docs/stable/nn.html#torch.nn.Module.apply" target="_blank" rel="noopener">这里</a>得知如何给module增加新的function</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xavier_normal</span><span class="params">(shape)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create random Tensors for weights; setting requires_grad=True means that we</span></span><br><span class="line"><span class="string">    want to compute gradients for these Tensors during the backward pass.</span></span><br><span class="line"><span class="string">    We use Xavier normalization: sqrt(2 / (fan_in + fan_out))</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> len(shape) == <span class="number">2</span>:  <span class="comment"># FC weight</span></span><br><span class="line">        fan_in = shape[<span class="number">1</span>]</span><br><span class="line">        fan_out = shape[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fan_in = np.prod(shape[<span class="number">1</span>:]) <span class="comment"># conv weight [out_channel, in_channel, kH, kW]</span></span><br><span class="line">        fan_out = shape[<span class="number">0</span>] * shape[<span class="number">2</span>] * shape[<span class="number">3</span>]</span><br><span class="line">    <span class="comment"># randn is standard normal distribution generator. </span></span><br><span class="line">    w = torch.randn(shape, device=device, dtype=dtype) * np.sqrt(<span class="number">2.</span> / (fan_in + fan_out))</span><br><span class="line">    w.requires_grad = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> w</span><br><span class="line"></span><br><span class="line">channel_1 = <span class="number">32</span></span><br><span class="line">channel_2 = <span class="number">16</span></span><br><span class="line">learning_rate = <span class="number">1e-2</span></span><br><span class="line"></span><br><span class="line">model = <span class="literal">None</span></span><br><span class="line">optimizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> Rewrite the 2-layer ConvNet with bias from Part III with the           #</span></span><br><span class="line"><span class="comment"># Sequential API.                                                              #</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">3</span>, channel_1,<span class="number">5</span>,stride = <span class="number">1</span>,padding = <span class="number">2</span>),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Conv2d(channel_1, channel_2,<span class="number">3</span>,stride = <span class="number">1</span>,padding = <span class="number">1</span>),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    Flatten(),</span><br><span class="line">    nn.Linear(<span class="number">32</span>*<span class="number">32</span>*channel_2, <span class="number">10</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_weights</span><span class="params">(m)</span>:</span></span><br><span class="line">    print(m)</span><br><span class="line">    <span class="keyword">if</span> type(m) == nn.Linear:</span><br><span class="line">        m.weight.data = xavier_normal(m.weight.size())</span><br><span class="line">        m.bias.data = zero_weight(m.bias.size())</span><br><span class="line"></span><br><span class="line">model.apply(init_weights)</span><br><span class="line"></span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=learning_rate,</span><br><span class="line">                     momentum=<span class="number">0.9</span>, nesterov=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#                                 END OF YOUR CODE                             </span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"></span><br><span class="line">train_part34(model, optimizer)</span><br></pre></td></tr></table></figure>
<h2 id="Part5-来训练CIFAR-10吧！"><a href="#Part5-来训练CIFAR-10吧！" class="headerlink" title="Part5 来训练CIFAR-10吧！"></a>Part5 来训练CIFAR-10吧！</h2><p>自己找net的结构，hyper，loss，optimizers来把CIFAR-10的val_acc在10个epoch之内升到70%以上！</p>
<ul>
<li>Layers in torch.nn package: <a href="http://pytorch.org/docs/stable/nn.html" target="_blank" rel="noopener">http://pytorch.org/docs/stable/nn.html</a></li>
<li>Activations: <a href="http://pytorch.org/docs/stable/nn.html#non-linear-activations" target="_blank" rel="noopener">http://pytorch.org/docs/stable/nn.html#non-linear-activations</a></li>
<li>Loss functions: <a href="http://pytorch.org/docs/stable/nn.html#loss-functions" target="_blank" rel="noopener">http://pytorch.org/docs/stable/nn.html#loss-functions</a></li>
<li>Optimizers: <a href="http://pytorch.org/docs/stable/optim.html" target="_blank" rel="noopener">http://pytorch.org/docs/stable/optim.html</a></li>
</ul>
<p>一些可能的方法：</p>
<ul>
<li><strong>Filter size</strong>: Above we used 5x5; would smaller filters be more efficient?</li>
<li><strong>Number of filters</strong>: Above we used 32 filters. Do more or fewer do better?</li>
<li><strong>Pooling vs Strided Convolution</strong>: Do you use max pooling or just stride convolutions?</li>
<li><strong>Batch normalization</strong>: Try adding spatial batch normalization after convolution layers and vanilla batch normalization after affine layers. Do your networks train faster?</li>
<li><strong>Network architecture</strong>: The network above has two layers of trainable parameters. Can you do better with a deep network? Good architectures to try include:<ul>
<li>[conv-relu-pool]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li>
<li>[conv-relu-conv-relu-pool]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li>
<li>[batchnorm-relu-conv]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li>
</ul>
</li>
<li><strong>Global Average Pooling</strong>: Instead of flattening and then having multiple affine layers, perform convolutions until your image gets small (7x7 or so) and then perform an average pooling operation to get to a 1x1 image picture (1, 1 , Filter#), which is then reshaped into a (Filter#) vector. This is used in <a href="https://arxiv.org/abs/1512.00567" target="_blank" rel="noopener">Google’s Inception Network</a> (See Table 1 for their architecture).</li>
<li><strong>Regularization</strong>: Add l2 weight regularization, or perhaps use Dropout.</li>
</ul>
<p>一些tips：</p>
<ul>
<li>应该会在几百个iter里面就看到进步，如果params work well</li>
<li>tune hyper的时候从一大片range和小的train开始，找到好一些的之后再围绕这个范围找（多训一点）</li>
<li>在找hyper的时候应该用val set</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">model = <span class="literal">None</span></span><br><span class="line">optimizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># *****START OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"></span><br><span class="line">channel_1 = <span class="number">16</span></span><br><span class="line">channel_2 = <span class="number">32</span></span><br><span class="line">channel_3 = <span class="number">64</span></span><br><span class="line">channel_4 = <span class="number">64</span></span><br><span class="line"></span><br><span class="line">fc_1 = <span class="number">1024</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">3</span>, channel_1,<span class="number">3</span>,stride = <span class="number">1</span>,padding = <span class="number">1</span>),</span><br><span class="line">    nn.BatchNorm2d(channel_1),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size = <span class="number">2</span>),</span><br><span class="line">    nn.Conv2d(channel_1, channel_2,<span class="number">3</span>,stride = <span class="number">1</span>,padding = <span class="number">1</span>),</span><br><span class="line">    nn.BatchNorm2d(channel_2),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size = <span class="number">2</span>),</span><br><span class="line">    nn.Conv2d(channel_2, channel_3,<span class="number">3</span>,stride = <span class="number">1</span>,padding = <span class="number">1</span>),</span><br><span class="line">    nn.BatchNorm2d(channel_3),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Conv2d(channel_3, channel_4,<span class="number">3</span>,stride = <span class="number">1</span>,padding = <span class="number">1</span>),</span><br><span class="line">    nn.BatchNorm2d(channel_4),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size = <span class="number">2</span>),</span><br><span class="line">    Flatten(),</span><br><span class="line">    nn.Linear(<span class="number">4</span>*<span class="number">4</span>*channel_4, num_classes)</span><br><span class="line"><span class="comment">#     nn.Linear(fc_1,num_classes)</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">learning_rate = <span class="number">1e-3</span></span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=learning_rate,</span><br><span class="line">                     betas=(<span class="number">0.9</span>, <span class="number">0.999</span>), eps=<span class="number">1e-08</span>, weight_decay=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># *****END OF YOUR CODE (DO NOT DELETE/MODIFY THIS LINE)*****</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#                                 END OF YOUR CODE                             </span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You should get at least 70% accuracy</span></span><br><span class="line">train_part34(model, optimizer, epochs=<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>第四层conv试过ksize=1，效果不是很好</li>
<li>BN好像效果很好</li>
<li>maxpool多一些，计算负担少而且效果好像比较好</li>
<li>最终val_acc在77-79左右，test_acc = 76.22</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/05/07/关于python生成动态变量名/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/07/关于python生成动态变量名/" class="post-title-link" itemprop="url">关于python生成动态变量名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-07 12:29:40 / Modified: 12:38:16" itemprop="dateCreated datePublished" datetime="2019-05-07T12:29:40+09:00">2019-05-07</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编程语言/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编程语言/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="动态生成变量名"><a href="#动态生成变量名" class="headerlink" title="动态生成变量名"></a>动态生成变量名</h2><p>如果想要生成一系列的a0，a1，….a20这种变量名，直接手写太麻烦了</p>
<h2 id="locals"><a href="#locals" class="headerlink" title="locals"></a>locals</h2><p>local()，以字典的类型返回当前位置的全部局部变量</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arrange_list = locals()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">	arrange_list[<span class="string">'list_'</span> + str(i)] = []</span><br></pre></td></tr></table></figure>
<p>调用动态变量，可以用字典的get方法得到变量的值</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arrange_list = locals()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">	<span class="built_in">print</span>(arrange_list.<span class="built_in">get</span>('<span class="built_in">var</span>'+str(i)), end = <span class="string">" "</span>)</span><br></pre></td></tr></table></figure>
<h2 id="利用exec进行赋值"><a href="#利用exec进行赋值" class="headerlink" title="利用exec进行赋值"></a>利用exec进行赋值</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">	exec(<span class="string">'var&#123;&#125; = &#123;&#125;'</span>.format(<span class="selector-tag">i</span>, i))</span><br></pre></td></tr></table></figure>
<p>调用动态变量<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(5):</span><br><span class="line">	exec('<span class="keyword">print</span>(<span class="keyword">var</span>&#123;&#125;, end = <span class="string">" "</span>)'.<span class="keyword">format</span>(i))</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/25/关于多维数组的转置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/25/关于多维数组的转置/" class="post-title-link" itemprop="url">关于多维数组的转置和增加新的维度</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-25 20:35:23" itemprop="dateCreated datePublished" datetime="2019-04-25T20:35:23+09:00">2019-04-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-26 13:45:52" itemprop="dateModified" datetime="2019-04-26T13:45:52+09:00">2019-04-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编程语言/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编程语言/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编程语言/Python/Numpy/" itemprop="url" rel="index"><span itemprop="name">Numpy</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在二维转置的时候，a[i][j] = a[j][i]<br>在多维数组转置的时候，需要交换他们的下标<br>比如原来的数组是(X,Y,Z)，转置之后是(Z,X,Y)<br>这时候应该用的是np.transpose(A,(2,0,1))</p>
<!-- br -->
<p>np.newaxis -&gt; 增加新的维度<br>原来是（6，）的数组，在行上增加维度变成（1,6）的二维数组，在列上增加维度变为(6,1)的二维数组</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/22/OpenCVCameracalibration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/22/OpenCVCameracalibration/" class="post-title-link" itemprop="url">学习OpenCV十八章_Camera models & calibration</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-22 13:25:19" itemprop="dateCreated datePublished" datetime="2019-04-22T13:25:19+09:00">2019-04-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-25 16:52:36" itemprop="dateModified" datetime="2019-04-25T16:52:36+09:00">2019-04-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/OpenCV/Calibration/" itemprop="url" rel="index"><span itemprop="name">Calibration</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="camera-models-amp-calibration"><a href="#camera-models-amp-calibration" class="headerlink" title="camera models &amp; calibration"></a>camera models &amp; calibration</h1><p>物体会吸收一部分的光，然后反射一部分的光，反射的光就是他自己的颜色，这个光被我们的眼睛（或者相机）接收，然后投影到我们的视网膜（或者相机的图片）上，这之间的几何关系在CV上面非常重要</p>
<p>其中一个非常简单的模型就是pinhole camera model。光穿过一面墙上的一个小的aperture，这个是这章的模型的开始，但是真实pinhole模型不是很好因为他不能快速曝光（聚集的光不够）-&gt; 眼睛会更厉害一点，但是len还会distort图片。</p>
<p>这章的目的：</p>
<ul>
<li>如何camera calibration</li>
<li>纠正普通的pinhole模型的len的偏差</li>
<li>calibration也同样是获取三维世界的主要方式，因为一个场景不仅仅是三维，他们还有物理的空间和体积，所以获取pixel和三维诗句坐标的关系也很重要</li>
<li>18章纠正的是len的distortion，19章构建整个3D的结构</li>
</ul>
<p>homography transform -&gt; 一个非常重要的要素</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/22/OpenCVCameracalibration/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/18/CS231nassignment2CNN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/18/CS231nassignment2CNN/" class="post-title-link" itemprop="url">CS231nassignment2CNN</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-18 15:12:13" itemprop="dateCreated datePublished" datetime="2019-04-18T15:12:13+09:00">2019-04-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-25 21:05:41" itemprop="dateModified" datetime="2019-04-25T21:05:41+09:00">2019-04-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/CS231n作业/" itemprop="url" rel="index"><span itemprop="name">CS231n作业</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="target"><a href="#target" class="headerlink" title="target"></a>target</h2><ul>
<li>之前已经实践了fc的相关东西，但是在实际的使用里大家使用的都是CNN</li>
<li>所以这部分就开始实践CNN了</li>
</ul>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/18/CS231nassignment2CNN/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/18/CS231nassignment2Dropout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/18/CS231nassignment2Dropout/" class="post-title-link" itemprop="url">CS231nassignment2之Dropout</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-18 09:51:56 / Modified: 15:11:08" itemprop="dateCreated datePublished" datetime="2019-04-18T09:51:56+09:00">2019-04-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/CS231n作业/" itemprop="url" rel="index"><span itemprop="name">CS231n作业</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul>
<li>regularization NN</li>
<li>randomly setting some features to 0 during <strong>forward pass</strong></li>
</ul>
<p><a href="https://arxiv.org/abs/1207.0580" target="_blank" rel="noopener">Geoffrey E. Hinton et al, “Improving neural networks by preventing co-adaptation of feature detectors”, arXiv 2012</a></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/18/CS231nassignment2Dropout/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/16/OpenGL笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/16/OpenGL笔记/" class="post-title-link" itemprop="url">OpenGL笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-16 15:57:45" itemprop="dateCreated datePublished" datetime="2019-04-16T15:57:45+09:00">2019-04-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-05-09 17:00:36" itemprop="dateModified" datetime="2019-05-09T17:00:36+09:00">2019-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OpenGl/" itemprop="url" rel="index"><span itemprop="name">OpenGl</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://learnopengl.com/" target="_blank" rel="noopener">Learn OpenGl</a></p>
<p>on Modern OpenGL. -&gt; 从graphics的programming开始讲的</p>
<h1 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h1><h2 id="OPENGL"><a href="#OPENGL" class="headerlink" title="OPENGL"></a>OPENGL</h2><ul>
<li>是一个进行图像处理的工具</li>
<li>可以被认为是API，但是实际上是specification<ul>
<li>明确说明了每个function应该的输入和输出，以及如何perform</li>
<li>用户在用这个说明来解决问题，因为没有给出明确的implement的过程，所以只要结果符合规则，怎么implement都可以</li>
</ul>
</li>
</ul>
<h3 id="Core-profile-vs-Immediate-mode"><a href="#Core-profile-vs-Immediate-mode" class="headerlink" title="Core-profile vs Immediate mode"></a>Core-profile vs Immediate mode</h3><ul>
<li>以前的版本用的是immediate mode<ul>
<li>比较好用来画图</li>
<li>具体的是实现都在lib里面，developer不是很好的能看到如何计算</li>
<li>效率越来越低</li>
</ul>
</li>
<li>Core-profile<ul>
<li>在3.2版本之后改成了这个</li>
<li>强制使用modern practices，如果想要用被分出去的function就会直接报错</li>
<li>效率高，更灵活，更难学</li>
</ul>
</li>
</ul>
<h3 id="extensions"><a href="#extensions" class="headerlink" title="extensions"></a>extensions</h3><ul>
<li>支持extensions，只要检查支不支持graphic card就可以知道能不能用</li>
<li>可以直接用比较新的东西，不用等着OPENGL更新新的功能</li>
<li>需要在用之前判断他是不是available的，如果不是需要用原来的方法搞</li>
</ul>
<h3 id="State-Machine"><a href="#State-Machine" class="headerlink" title="State Machine"></a>State Machine</h3><ul>
<li>OpenGL自己就是一个State Machine：一个var的集合，来判断他现在应该如何操作</li>
<li>state -&gt; context<ul>
<li>改变state：设定一些options，操作一些buffer，在现在的context来render</li>
</ul>
</li>
<li>例子：<ul>
<li>如果我想画三角形，而不是画线了，就改变draw的state</li>
<li>只要这个改变传达到了，下一条线就画的是三角形了</li>
</ul>
</li>
<li><code>state-changing</code>用来改变context，<code>state-using</code>在现在的state上面开始进行操作</li>
</ul>
<h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><ul>
<li>一个集合来表现OpenGL的subset的state<ul>
<li>比如可以用一个object来表示对window的设定，可以设置大小，设置支持的颜色等等<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The State of OpenGL</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OpenGL_Context</span> &#123;</span></span><br><span class="line">  	...</span><br><span class="line">  	object_name* object_Window_Target;</span><br><span class="line">  	...  	</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create object</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> objectId = <span class="number">0</span>;</span><br><span class="line">glGenObject(<span class="number">1</span>, &amp;objectId);</span><br><span class="line"><span class="comment">// bind object to context</span></span><br><span class="line">glBindObject(GL_WINDOW_TARGET, objectId);</span><br><span class="line"><span class="comment">// set options of object currently bound to GL_WINDOW_TARGET</span></span><br><span class="line">glSetObjectOption(GL_WINDOW_TARGET, GL_OPTION_WINDOW_WIDTH, <span class="number">800</span>);</span><br><span class="line">glSetObjectOption(GL_WINDOW_TARGET, GL_OPTION_WINDOW_HEIGHT, <span class="number">600</span>);</span><br><span class="line"><span class="comment">// set context target back to default</span></span><br><span class="line">glBindObject(GL_WINDOW_TARGET, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>流程<ul>
<li>首先创建了一个object，里面存了一个ref是这个object的id</li>
<li>然后把这个object和context的目标位置bind在了一起</li>
<li>设置了这些window的参数</li>
<li>最后un-bind这两个东西，把window target改回原来的值</li>
</ul>
</li>
<li>这样的话我们可以创建很多object，提前设置好里面的量，等到需要用的时候就直接bind就可以用了<ul>
<li>比如我们有一堆object包含了小人，小马，小鹿</li>
<li>想画哪个就把哪个绑定到draw里面，就可以直接画出来了</li>
</ul>
</li>
</ul>
<h2 id="Crateing-a-window"><a href="#Crateing-a-window" class="headerlink" title="Crateing a window"></a>Crateing a window</h2><p>因为操作系统的问题，所有操作系统上面不是很一样。但是已经有一些提供这些功能的函数了，这里用的是GLFW</p>
<h3 id="GLFW"><a href="#GLFW" class="headerlink" title="GLFW"></a>GLFW</h3><ul>
<li>一个lib，用C写的，主要目的是提供把东西渲染到屏幕的功能</li>
<li>可以创建一个context，定义窗口的params，处理用户的输入</li>
</ul>
<p>已经一口气配置好了这些！<br><a href="https://www.jianshu.com/p/25d5fbf792a2" target="_blank" rel="noopener">https://www.jianshu.com/p/25d5fbf792a2</a></p>
<h3 id="GLAD"><a href="#GLAD" class="headerlink" title="GLAD"></a>GLAD</h3><ul>
<li>因为openGL还需要不同版本的driver的支持，需要有东西来处理这部分的内容</li>
<li>和其他的东西不同，GLAD用的是<a href="https://glad.dav1d.de/" target="_blank" rel="noopener">web service</a><ul>
<li>在这个网页上选择好语言，版本号，确保profile是core，然后生成</li>
<li>直接下载下来对应的zip，然后把include放进include里面，.c文件放在project里面</li>
</ul>
</li>
<li>莫名其妙并不需要这一步，神奇，可能是我在include里面已经搞进来了！！</li>
</ul>
<h2 id="Hello-Window"><a href="#Hello-Window" class="headerlink" title="Hello Window"></a>Hello Window</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    glfwInit();</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line">    <span class="comment">//glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先进行了初始化</li>
<li>然后configure了GLFW，设置了a large enum of possible options prefixed with GLFW_. （第三行就是最小） -&gt; 大概是设置要用GLFW的版本号</li>
<li>然后也告诉了他想用core</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bigphess.github.io/2019/04/15/CS231Nassignment2BN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUOPENG XU">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="今天开始努力学习">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/15/CS231Nassignment2BN/" class="post-title-link" itemprop="url">CS231Nassignment2之Batch Normalization</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-15 14:21:16" itemprop="dateCreated datePublished" datetime="2019-04-15T14:21:16+09:00">2019-04-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-18 09:52:30" itemprop="dateModified" datetime="2019-04-18T09:52:30+09:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/图像处理/Deep-Learning/CS231n作业/" itemprop="url" rel="index"><span itemprop="name">CS231n作业</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="target"><a href="#target" class="headerlink" title="target"></a>target</h2><ul>
<li>之前的内容讲了lr的优化方法，比如Adam，另一种方法是根据改变网络的结构，make it easy to train -&gt; batch normalization</li>
<li>想去掉一些uncorrelated features(不相关的特征)，可以在训练数据之前preprocess，变成0-centered分布，这样第一层是没有问题的，但是后面的层里还是会出问题</li>
<li>所以把normalization的部分加入了DN里面，加入了一个BN层，会估计mean和standard deviation of each feature，这样重新centre和normalized</li>
<li>learnable shift and scale parameters for each feature dimension</li>
<li><strong><em>核心思想：粗暴的用BN来解决weights初始化的问题</em></strong></li>
</ul>
<p>ref：<a href="https://kratzert.github.io/2016/02/12/understanding-the-gradient-flow-through-the-batch-normalization-layer.html" target="_blank" rel="noopener">https://kratzert.github.io/2016/02/12/understanding-the-gradient-flow-through-the-batch-normalization-layer.html</a><br></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/15/CS231Nassignment2BN/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.jpeg" alt="RUOPENG XU">
            
              <p class="site-author-name" itemprop="name">RUOPENG XU</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/Bigphess" title="GitHub &rarr; https://github.com/Bigphess" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:xrp0308@gmail.com" title="E-Mail &rarr; mailto:xrp0308@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RUOPENG XU</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  



  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
